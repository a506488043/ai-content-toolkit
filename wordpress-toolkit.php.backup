<?php
/**
 * Plugin Name: WordPress Toolkit
 * Plugin URI: https://www.saiita.com.cn
 * Description: ä¸€ä¸ªé›†æˆäº†ç½‘ç«™å¡ç‰‡ã€å¹´é¾„è®¡ç®—å™¨ã€ç‰©å“ç®¡ç†ã€å‹æƒ…é“¾æ¥ã€è‡ªåŠ¨æ‘˜è¦ç”Ÿæˆã€CookieåŒæ„é€šçŸ¥å’ŒRESTä»£ç†ä¿®å¤çš„ç»¼åˆå·¥å…·åŒ…ã€‚
 * Version: 1.0.5
 * Author: www.saiita.com.cn
 * Author URI: https://www.saiita.com.cn
 * License: GPL v2 or later
 * License URI: https://www.gnu.org/licenses/gpl-2.0.html
 * Text Domain: wordpress-toolkit
 * Domain Path: /languages
 * Requires at least: 5.0
 * Tested up to: 6.4
 * Requires PHP: 7.4
 * Network: false
 */

// é˜²æ­¢ç›´æ¥è®¿é—®
if (!defined('ABSPATH')) {
    exit;
}

// å®šä¹‰æ’ä»¶å¸¸é‡
define('WORDPRESS_TOOLKIT_VERSION', '1.0.5');
define('WORDPRESS_TOOLKIT_PLUGIN_URL', plugin_dir_url(__FILE__));
define('WORDPRESS_TOOLKIT_PLUGIN_PATH', plugin_dir_path(__FILE__));
define('WORDPRESS_TOOLKIT_PLUGIN_BASENAME', plugin_basename(__FILE__));

// å›½é™…åŒ–æ”¯æŒå·²ç§»é™¤ - ç›´æ¥ä½¿ç”¨WordPressåŸç”Ÿç¿»è¯‘å‡½æ•°

// åŠ è½½æ—¥å¿—ç®¡ç†
require_once WORDPRESS_TOOLKIT_PLUGIN_PATH . 'includes/class-logger.php';

// åŠ è½½ç®¡ç†é¡µé¢æ¨¡æ¿ç³»ç»Ÿ
require_once WORDPRESS_TOOLKIT_PLUGIN_PATH . 'includes/class-admin-page-template.php';

// åŠ è½½RESTä»£ç†ä¿®å¤æ¨¡å—
require_once WORDPRESS_TOOLKIT_PLUGIN_PATH . 'modules/rest-proxy-fix.php';

/**
 * WordPress Toolkit ä¸»ç±»
 */
class WordPress_Toolkit {
    
    /**
     * å•ä¾‹å®ä¾‹
     */
    private static $instance = null;
    
    /**
     * å­æ¨¡å—å®ä¾‹
     */
    private $custom_card = null;
    private $age_calculator = null;
    private $time_capsule = null;
    private $cookieguard = null;
    private $simple_friendlink = null;
    private $simple_friendlink_admin = null;
    private $auto_excerpt = null;
    
    /**
     * è·å–å•ä¾‹å®ä¾‹
     */
    public static function get_instance() {
        if (null === self::$instance) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    /**
     * æ„é€ å‡½æ•°
     */
    private function __construct() {
        $this->init_hooks();
        $this->load_modules();
    }
    
    /**
     * åˆå§‹åŒ–é’©å­
     */
    private function init_hooks() {
        // æ’ä»¶æ¿€æ´»å’Œåœç”¨é’©å­
        register_activation_hook(__FILE__, array($this, 'activate'));
        register_deactivation_hook(__FILE__, array($this, 'deactivate'));
        
        // WordPressåˆå§‹åŒ–é’©å­
        add_action('init', array($this, 'init'));
        add_action('admin_menu', array($this, 'add_admin_menu'));
        add_action('admin_enqueue_scripts', array($this, 'admin_enqueue_scripts'));
        add_action('wp_enqueue_scripts', array($this, 'enqueue_scripts'));
        
        // æ’ä»¶é“¾æ¥
        add_filter('plugin_action_links_' . WORDPRESS_TOOLKIT_PLUGIN_BASENAME, array($this, 'add_plugin_links'));
    }
    
    /**
     * åŠ è½½å­æ¨¡å—
     */
    private function load_modules() {
        // åŠ è½½Custom Cardæ¨¡å—
        require_once WORDPRESS_TOOLKIT_PLUGIN_PATH . 'modules/custom-card/custom-card-module.php';
        $this->custom_card = new Custom_Card_Module();
        
        // åŠ è½½Age Calculatoræ¨¡å—
        require_once WORDPRESS_TOOLKIT_PLUGIN_PATH . 'modules/age-calculator/age-calculator-module.php';
        $this->age_calculator = new Age_Calculator_Module();
        
        // åŠ è½½Time Capsuleæ¨¡å—
        require_once WORDPRESS_TOOLKIT_PLUGIN_PATH . 'modules/time-capsule/time-capsule-module.php';
        $this->time_capsule = new Time_Capsule_Module();
        
        // åŠ è½½CookieGuardæ¨¡å—
        require_once WORDPRESS_TOOLKIT_PLUGIN_PATH . 'modules/cookieguard/cookieguard-module.php';
        $this->cookieguard = CookieGuard_Module::get_instance();

        // åŠ è½½Simple FriendLinkæ¨¡å—
        require_once WORDPRESS_TOOLKIT_PLUGIN_PATH . 'modules/simple-friendlink/simple-friendlink-module.php';
        $this->simple_friendlink = Simple_FriendLink_Module::get_instance();

        // åŠ è½½Simple FriendLinkç®¡ç†é¡µé¢
        require_once WORDPRESS_TOOLKIT_PLUGIN_PATH . 'modules/simple-friendlink/admin.php';
        $this->simple_friendlink_admin = new Simple_FriendLink_Admin();

        // åŠ è½½Auto Excerptæ¨¡å—
        require_once WORDPRESS_TOOLKIT_PLUGIN_PATH . 'modules/auto-excerpt/auto-excerpt-module.php';
        $this->auto_excerpt = Auto_Excerpt_Module::get_instance();

        // Auto Excerpt ç®¡ç†åŠŸèƒ½å·²æ•´åˆåˆ°è®¾ç½®é¡µé¢ï¼Œæ— éœ€é¢å¤–åŠ è½½

        // è°ƒè¯•æ—¥å¿—
        if (defined('WP_DEBUG') && WP_DEBUG) {
            error_log('WordPress Toolkit: Modules loaded - Custom Card: ' . ($this->custom_card ? 'Yes' : 'No'));
        }
    }
    
    /**
     * æ’ä»¶æ¿€æ´»
     */
    public function activate() {
        // å…ˆåŠ è½½æ¨¡å—
        $this->load_modules();
        
        // æ¿€æ´»æ‰€æœ‰å­æ¨¡å—
        if ($this->custom_card) $this->custom_card->activate();
        if ($this->age_calculator) $this->age_calculator->activate();
        if ($this->time_capsule) $this->time_capsule->activate();
        if ($this->cookieguard) $this->cookieguard->activate();
        if ($this->simple_friendlink) $this->simple_friendlink->activate();
        if ($this->auto_excerpt) $this->auto_excerpt->activate();
        
        // è®¾ç½®æ’ä»¶æ¿€æ´»æ—¶é—´
        add_option('wordpress_toolkit_activated_time', current_time('timestamp'));
    }
    
    /**
     * æ’ä»¶åœç”¨
     */
    public function deactivate() {
        // åœç”¨æ‰€æœ‰å­æ¨¡å—
        if ($this->custom_card) $this->custom_card->deactivate();
        if ($this->age_calculator) $this->age_calculator->deactivate();
        if ($this->time_capsule) $this->time_capsule->deactivate();
        if ($this->cookieguard) $this->cookieguard->deactivate();
        if ($this->simple_friendlink) $this->simple_friendlink->deactivate();
        if ($this->auto_excerpt) $this->auto_excerpt->deactivate();
    }
    
    /**
     * åˆå§‹åŒ–
     */
    public function init() {
        // åŠ è½½æ–‡æœ¬åŸŸ
        load_plugin_textdomain('wordpress-toolkit', false, dirname(plugin_basename(__FILE__)) . '/languages');
        
        // åˆå§‹åŒ–æ‰€æœ‰å­æ¨¡å—
        if ($this->custom_card) $this->custom_card->init();
        if ($this->age_calculator) $this->age_calculator->init();
        if ($this->time_capsule) $this->time_capsule->init();
        if ($this->cookieguard) $this->cookieguard->init();
        if ($this->simple_friendlink) $this->simple_friendlink->init();
        if ($this->auto_excerpt) $this->auto_excerpt->init();
    }
    
    /**
     * æ·»åŠ ç®¡ç†èœå• - é‡æ–°ç»„ç»‡ç»“æ„
     */
    public function add_admin_menu() {
        // ======================
        // å·¥å…·ç®±èœå• - æ•°æ®æŸ¥çœ‹å’Œæ“ä½œ
        // ======================

        // æ·»åŠ ä¸»èœå• - ä½¿ç”¨è¾ƒä½æƒé™è®©è®¢é˜…è€…ä¹Ÿèƒ½çœ‹åˆ°
        add_menu_page(
            'WordPress Toolkit',
            __('å·¥å…·ç®±', 'wordpress-toolkit'),
            'read', // ä½¿ç”¨åŸºç¡€é˜…è¯»æƒé™ï¼Œæ‰€æœ‰ç™»å½•ç”¨æˆ·éƒ½æœ‰
            'wordpress-toolkit',
            array($this, 'admin_page'),
            'dashicons-admin-tools',
            30
        );

        // ç½‘ç«™å¡ç‰‡ï¼ˆä»…ç®¡ç†å‘˜å¯è§ï¼‰
        if (current_user_can('manage_options')) {
            add_submenu_page(
                'wordpress-toolkit',
                __('ç½‘ç«™å¡ç‰‡', 'wordpress-toolkit'),
                __('ç½‘ç«™å¡ç‰‡', 'wordpress-toolkit'),
                'manage_options',
                'wordpress-toolkit-cards-list',
                array($this, 'custom_cards_list_page')
            );
        }

        // ç‰©å“ç®¡ç†ï¼ˆè®¢é˜…è€…å’Œç®¡ç†å‘˜éƒ½å¯è§ï¼‰
        add_submenu_page(
            'wordpress-toolkit',
            __('ç‰©å“ç®¡ç†', 'wordpress-toolkit'),
            __('ç‰©å“ç®¡ç†', 'wordpress-toolkit'),
            'read', // ä½¿ç”¨åŸºç¡€é˜…è¯»æƒé™
            'wordpress-toolkit-time-capsule',
            array($this, 'time_capsule_admin_page')
        );

        // å‹æƒ…é“¾æ¥ï¼ˆä»…ç®¡ç†å‘˜å¯è§ï¼‰
        if (current_user_can('manage_options')) {
            add_submenu_page(
                'wordpress-toolkit',
                __('å‹æƒ…é“¾æ¥', 'wordpress-toolkit'),
                __('å‹æƒ…é“¾æ¥', 'wordpress-toolkit'),
                'manage_options',
                'wordpress-toolkit-friendlinks',
                array($this, 'friendlinks_admin_page')
            );
        }

        // è‡ªåŠ¨æ‘˜è¦ï¼ˆä»…ç®¡ç†å‘˜å¯è§ï¼‰
        if (current_user_can('manage_options')) {
            add_submenu_page(
                'wordpress-toolkit',
                __('è‡ªåŠ¨æ‘˜è¦', 'wordpress-toolkit'),
                __('è‡ªåŠ¨æ‘˜è¦', 'wordpress-toolkit'),
                'manage_options',
                'wordpress-toolkit-auto-excerpt',
                array($this, 'auto_excerpt_admin_page')
            );
        }


        // ======================
        // è®¾ç½®èœå• - æ’ä»¶é…ç½®
        // ======================

        // ç½‘ç«™å¡ç‰‡è®¾ç½®
        add_options_page(
            __('ç½‘ç«™å¡ç‰‡è®¾ç½®', 'wordpress-toolkit'),
            __('ç½‘ç«™å¡ç‰‡', 'wordpress-toolkit'),
            'manage_options',
            'wordpress-toolkit-custom-card-settings',
            array($this, 'custom_card_settings_page')
        );

        // å¹´é¾„è®¡ç®—å™¨è®¾ç½®
        add_options_page(
            __('å¹´é¾„è®¡ç®—å™¨è®¾ç½®', 'wordpress-toolkit'),
            __('å¹´é¾„è®¡ç®—å™¨', 'wordpress-toolkit'),
            'manage_options',
            'wordpress-toolkit-age-calculator-settings',
            array($this, 'age_calculator_settings_page')
        );

        // CookieåŒæ„è®¾ç½®
        add_options_page(
            __('CookieåŒæ„è®¾ç½®', 'wordpress-toolkit'),
            __('CookieåŒæ„', 'wordpress-toolkit'),
            'manage_options',
            'wordpress-toolkit-cookieguard-settings',
            array($this, 'cookieguard_settings_page')
        );

        // ç®€æ´å‹æƒ…é“¾æ¥è®¾ç½®
        add_options_page(
            __('ç®€æ´å‹æƒ…é“¾æ¥', 'wordpress-toolkit'),
            __('ç®€æ´å‹æƒ…é“¾æ¥', 'wordpress-toolkit'),
            'manage_options',
            'wordpress-toolkit-simple-friendlink-settings',
            array($this, 'simple_friendlink_settings_page')
        );

        // è‡ªåŠ¨æ‘˜è¦è®¾ç½®
        add_options_page(
            __('è‡ªåŠ¨æ‘˜è¦è®¾ç½®', 'wordpress-toolkit'),
            __('è‡ªåŠ¨æ‘˜è¦', 'wordpress-toolkit'),
            'manage_options',
            'wordpress-toolkit-auto-excerpt-settings',
            array($this, 'auto_excerpt_settings_page')
        );
    }
    
    /**
     * åŠ è½½ç®¡ç†åå°è„šæœ¬å’Œæ ·å¼
     */
    public function admin_enqueue_scripts($hook) {
        // åªåœ¨æ’ä»¶ç›¸å…³é¡µé¢åŠ è½½ç»Ÿä¸€æ ·å¼å’Œè„šæœ¬
        if (strpos($hook, 'wordpress-toolkit') !== false || strpos($hook, 'options-general') !== false) {
            // åŠ è½½ç»Ÿä¸€CSSå˜é‡
            wp_enqueue_style(
                'toolkit-variables',
                WORDPRESS_TOOLKIT_PLUGIN_URL . 'assets/css/variables.css',
                array(),
                WORDPRESS_TOOLKIT_VERSION
            );

            // åŠ è½½é€šç”¨æ ·å¼
            wp_enqueue_style(
                'toolkit-common',
                WORDPRESS_TOOLKIT_PLUGIN_URL . 'assets/css/common.css',
                array('toolkit-variables'),
                WORDPRESS_TOOLKIT_VERSION
            );

            // åŠ è½½æ ¸å¿ƒJavaScriptæ¡†æ¶
            wp_enqueue_script(
                'toolkit-core',
                WORDPRESS_TOOLKIT_PLUGIN_URL . 'assets/js/toolkit-core.js',
                array('jquery'),
                WORDPRESS_TOOLKIT_VERSION,
                true
            );

            // åŠ è½½è¿ç§»åŠ©æ‰‹
            wp_enqueue_script(
                'toolkit-migration',
                WORDPRESS_TOOLKIT_PLUGIN_URL . 'assets/js/migration-helper.js',
                array('jquery', 'toolkit-core'),
                WORDPRESS_TOOLKIT_VERSION,
                true
            );

            // ä¼ é€’é…ç½®åˆ°JavaScript
            wp_localize_script('toolkit-core', 'ToolkitConfig', array(
                'ajaxUrl' => admin_url('admin-ajax.php'),
                'nonce' => wp_create_nonce('toolkit_nonce'),
                'strings' => array(
                    'saveSuccess' => __('ä¿å­˜æˆåŠŸï¼', 'wordpress-toolkit'),
                    'saveError' => __('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚', 'wordpress-toolkit'),
                    'networkError' => __('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•ã€‚', 'wordpress-toolkit'),
                    'confirmDelete' => __('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¡¹ç›®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚', 'wordpress-toolkit'),
                    'deleteSuccess' => __('åˆ é™¤æˆåŠŸï¼', 'wordpress-toolkit'),
                    'deleteError' => __('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚', 'wordpress-toolkit'),
                    'loading' => __('åŠ è½½ä¸­...', 'wordpress-toolkit'),
                    'processing' => __('å¤„ç†ä¸­...', 'wordpress-toolkit'),
                    'confirm' => __('ç¡®å®š', 'wordpress-toolkit'),
                    'cancel' => __('å–æ¶ˆ', 'wordpress-toolkit')
                )
            ));
        }

        // åŠ è½½å­æ¨¡å—çš„èµ„æºï¼ˆå·²é‡æ„ï¼Œä¸»è¦åŠ è½½æ¨¡å—ç‰¹å®šèµ„æºï¼‰
        if ($this->custom_card) $this->custom_card->admin_enqueue_scripts($hook);
        if ($this->age_calculator) $this->age_calculator->admin_enqueue_scripts($hook);
        if ($this->time_capsule) $this->time_capsule->admin_enqueue_scripts($hook);
        if ($this->cookieguard) $this->cookieguard->admin_enqueue_scripts($hook);
        if ($this->auto_excerpt) $this->auto_excerpt->admin_enqueue_scripts($hook);
        // Simple_FriendLink_Module ä¸éœ€è¦ç‰¹æ®Šçš„ç®¡ç†é¡µé¢èµ„æºåŠ è½½
    }
    
    /**
     * åŠ è½½å‰ç«¯è„šæœ¬å’Œæ ·å¼
     */
    public function enqueue_scripts() {
        // åŠ è½½å­æ¨¡å—çš„å‰ç«¯èµ„æº
        if ($this->custom_card) $this->custom_card->enqueue_scripts();
        if ($this->age_calculator) $this->age_calculator->enqueue_scripts();
        if ($this->time_capsule) $this->time_capsule->enqueue_scripts();
        if ($this->cookieguard) $this->cookieguard->enqueue_scripts();
        if ($this->simple_friendlink) $this->simple_friendlink->enqueue_scripts();
        if ($this->auto_excerpt) $this->auto_excerpt->enqueue_scripts();
    }
    
    /**
     * ä¸»ç®¡ç†é¡µé¢ - å®‰å…¨ç‰ˆæœ¬ï¼ˆç®€åŒ–ç‰ˆï¼‰
     */
    public function admin_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // æ˜¾ç¤ºå·¥å…·ç®±ä¸»é¡µé¢ï¼ŒåŒ…å«åŠŸèƒ½è¯´æ˜
        $this->toolbox_about_page();
    }
    
    /**
     * ç½‘ç«™å¡ç‰‡è®¾ç½®é¡µé¢ - æ”¾åœ¨è®¾ç½®èœå•ä¸­
     */
    public function custom_card_settings_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // éªŒè¯nonceï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰
        if (isset($_POST['action']) && !wp_verify_nonce($_POST['_wpnonce'], 'wordpress_toolkit_custom_card')) {
            wp_die(__('å®‰å…¨éªŒè¯å¤±è´¥', 'wordpress-toolkit'));
        }

        // è°ƒè¯•æ—¥å¿—
        if (defined('WP_DEBUG') && WP_DEBUG) {
            error_log('WordPress Toolkit: Custom Card settings page called');
        }

        if ($this->custom_card) {
            // è°ƒç”¨è‡ªå®šä¹‰å¡ç‰‡æ¨¡å—çš„è®¾ç½®é¡µé¢ï¼ˆåªæ˜¾ç¤ºè®¾ç½®é€‰é¡¹å¡ï¼‰
            $this->custom_card->settings_page();
        } else {
            echo '<div class="wrap"><h1>ç½‘ç«™å¡ç‰‡è®¾ç½®</h1><div class="error"><p>Custom Card æ¨¡å—æœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥æ’ä»¶è®¾ç½®ã€‚</p></div></div>';
        }
    }

    /**
     * å¹´é¾„è®¡ç®—å™¨è®¾ç½®é¡µé¢ - æ”¾åœ¨è®¾ç½®èœå•ä¸­
     */
    public function age_calculator_settings_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // éªŒè¯nonceï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰
        if (isset($_POST['action']) && !wp_verify_nonce($_POST['_wpnonce'], 'wordpress_toolkit_age_calculator')) {
            wp_die(__('å®‰å…¨éªŒè¯å¤±è´¥', 'wordpress-toolkit'));
        }

        if ($this->age_calculator) {
            // è°ƒç”¨å¹´é¾„è®¡ç®—å™¨æ¨¡å—çš„è®¾ç½®é¡µé¢
            $this->age_calculator->settings_page();
        } else {
            echo '<div class="wrap"><h1>å¹´é¾„è®¡ç®—å™¨è®¾ç½®</h1><div class="error"><p>Age Calculator æ¨¡å—æœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥æ’ä»¶è®¾ç½®ã€‚</p></div></div>';
        }
    }

    /**
     * ç‰©å“ç®¡ç†è®¾ç½®é¡µé¢ - æ”¾åœ¨è®¾ç½®èœå•ä¸­
     */
    public function time_capsule_settings_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // éªŒè¯nonceï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰
        if (isset($_POST['action']) && !wp_verify_nonce($_POST['_wpnonce'], 'wordpress_toolkit_time_capsule')) {
            wp_die(__('å®‰å…¨éªŒè¯å¤±è´¥', 'wordpress-toolkit'));
        }

        if ($this->time_capsule) {
            // è°ƒç”¨æ—¶é—´èƒ¶å›Šæ¨¡å—çš„è®¾ç½®é¡µé¢
            $this->time_capsule->settings_page();
        } else {
            echo '<div class="wrap"><h1>ç‰©å“ç®¡ç†è®¾ç½®</h1><div class="error"><p>Time Capsule æ¨¡å—æœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥æ’ä»¶è®¾ç½®ã€‚</p></div></div>';
        }
    }

    /**
     * CookieåŒæ„è®¾ç½®é¡µé¢ - æ”¾åœ¨è®¾ç½®èœå•ä¸­
     */
    public function cookieguard_settings_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // éªŒè¯nonceï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰
        if (isset($_POST['action']) && !wp_verify_nonce($_POST['_wpnonce'], 'wordpress_toolkit_cookieguard')) {
            wp_die(__('å®‰å…¨éªŒè¯å¤±è´¥', 'wordpress-toolkit'));
        }

        // å¤„ç†è¡¨å•æäº¤
        if (isset($_POST['action']) && $_POST['action'] === 'save_cookieguard_settings') {
            $this->save_cookieguard_settings();
        }

        // è·å–è®¾ç½®
        $settings = get_option('wordpress_toolkit_cookieguard_settings', array(
            'cookie_types' => array(),
            'theme' => 'light',
            'position' => 'bottom',
            'learn_more_url' => '',
            'privacy_policy_url' => '',
            'consent_expiry_days' => 365
        ));

        // æ·»åŠ è®¾ç½®é¡µé¢æ ·å¼
        wp_enqueue_style('cookieguard-admin', plugins_url('assets/cookieguard-admin.css', __FILE__));
        ?>
        <div class="wrap">
            <h1><?php _e('CookieåŒæ„è®¾ç½®', 'wordpress-toolkit'); ?></h1>

            <form method="post" action="">
                <input type="hidden" name="action" value="save_cookieguard_settings">
                <?php wp_nonce_field('wordpress_toolkit_cookieguard'); ?>

                <table class="form-table">
                    <tr>
                        <th scope="row"><?php _e('Cookieç±»å‹', 'wordpress-toolkit'); ?></th>
                        <td>
                            <label>
                                <input type="checkbox" name="cookie_types[]" value="necessary" checked disabled>
                                <?php _e('å¿…è¦Cookie', 'wordpress-toolkit'); ?> (<?php _e('å§‹ç»ˆå¯ç”¨', 'wordpress-toolkit'); ?>)
                            </label><br>
                            <label>
                                <input type="checkbox" name="cookie_types[]" value="functional" <?php echo in_array('functional', $settings['cookie_types']) ? 'checked' : ''; ?>>
                                <?php _e('åŠŸèƒ½æ€§Cookie', 'wordpress-toolkit'); ?>
                            </label><br>
                            <label>
                                <input type="checkbox" name="cookie_types[]" value="analytics" <?php echo in_array('analytics', $settings['cookie_types']) ? 'checked' : ''; ?>>
                                <?php _e('åˆ†ææ€§Cookie', 'wordpress-toolkit'); ?>
                            </label><br>
                            <label>
                                <input type="checkbox" name="cookie_types[]" value="marketing" <?php echo in_array('marketing', $settings['cookie_types']) ? 'checked' : ''; ?>>
                                <?php _e('è¥é”€æ€§Cookie', 'wordpress-toolkit'); ?>
                            </label>
                        </td>
                    </tr>

                    <tr>
                        <th scope="row"><?php _e('ä¸»é¢˜', 'wordpress-toolkit'); ?></th>
                        <td>
                            <select name="theme">
                                <option value="light" <?php selected($settings['theme'], 'light'); ?>><?php _e('æµ…è‰²', 'wordpress-toolkit'); ?></option>
                                <option value="dark" <?php selected($settings['theme'], 'dark'); ?>><?php _e('æ·±è‰²', 'wordpress-toolkit'); ?></option>
                                <option value="auto" <?php selected($settings['theme'], 'auto'); ?>><?php _e('è‡ªåŠ¨', 'wordpress-toolkit'); ?></option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <th scope="row"><?php _e('ä½ç½®', 'wordpress-toolkit'); ?></th>
                        <td>
                            <select name="position">
                                <option value="bottom" <?php selected($settings['position'], 'bottom'); ?>><?php _e('åº•éƒ¨', 'wordpress-toolkit'); ?></option>
                                <option value="top" <?php selected($settings['position'], 'top'); ?>><?php _e('é¡¶éƒ¨', 'wordpress-toolkit'); ?></option>
                                <option value="center" <?php selected($settings['position'], 'center'); ?>><?php _e('å±…ä¸­', 'wordpress-toolkit'); ?></option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <th scope="row"><?php _e('äº†è§£æ›´å¤šé“¾æ¥', 'wordpress-toolkit'); ?></th>
                        <td>
                            <input type="url" name="learn_more_url" value="<?php echo esc_url($settings['learn_more_url']); ?>" class="regular-text">
                            <p class="description"><?php _e('Cookieä½¿ç”¨è¯´æ˜é¡µé¢é“¾æ¥', 'wordpress-toolkit'); ?></p>
                        </td>
                    </tr>

                    <tr>
                        <th scope="row"><?php _e('éšç§æ”¿ç­–é“¾æ¥', 'wordpress-toolkit'); ?></th>
                        <td>
                            <input type="url" name="privacy_policy_url" value="<?php echo esc_url($settings['privacy_policy_url']); ?>" class="regular-text">
                            <p class="description"><?php _e('éšç§æ”¿ç­–é¡µé¢é“¾æ¥', 'wordpress-toolkit'); ?></p>
                        </td>
                    </tr>

                    <tr>
                        <th scope="row"><?php _e('åŒæ„æœ‰æ•ˆæœŸ', 'wordpress-toolkit'); ?></th>
                        <td>
                            <input type="number" name="consent_expiry_days" value="<?php echo $settings['consent_expiry_days']; ?>" min="1" max="3650" step="1">
                            <p class="description"><?php _e('ç”¨æˆ·CookieåŒæ„è®°å½•çš„æœ‰æ•ˆå¤©æ•°ï¼ˆé»˜è®¤ï¼š365å¤©ï¼‰', 'wordpress-toolkit'); ?></p>
                        </td>
                    </tr>
                </table>

                <p class="submit">
                    <input type="submit" name="save_settings" class="button button-primary" value="<?php _e('ä¿å­˜è®¾ç½®', 'wordpress-toolkit'); ?>">
                </p>
            </form>
        </div>
        <?php
    }

    /**
     * ä¿å­˜CookieGuardè®¾ç½®
     */
    private function save_cookieguard_settings() {
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        $cookie_types = isset($_POST['cookie_types']) ? array_map('sanitize_text_field', $_POST['cookie_types']) : array();

        $settings = array(
            'cookie_types' => $cookie_types,
            'theme' => sanitize_text_field($_POST['theme']),
            'position' => sanitize_text_field($_POST['position']),
            'learn_more_url' => esc_url_raw($_POST['learn_more_url']),
            'privacy_policy_url' => esc_url_raw($_POST['privacy_policy_url']),
            'consent_expiry_days' => intval($_POST['consent_expiry_days'])
        );

        update_option('wordpress_toolkit_cookieguard_settings', $settings);

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        add_settings_error('wordpress_toolkit_cookieguard_settings', 'settings_saved', __('è®¾ç½®å·²ä¿å­˜', 'wordpress-toolkit'), 'updated');
        set_transient('settings_errors', get_settings_errors(), 30);
    }

    /**
     * ç®€æ´å‹æƒ…é“¾æ¥è®¾ç½®é¡µé¢
     */
    public function simple_friendlink_settings_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // ä¿å­˜è®¾ç½®
        if (isset($_POST['save_settings'])) {
            $settings = array(
                'allow_user_submit' => isset($_POST['allow_user_submit']),
                'require_login' => isset($_POST['require_login']),
                'admin_approval' => isset($_POST['admin_approval']),
                'max_links_per_page' => intval($_POST['max_links_per_page'])
            );

            if (class_exists('Simple_FriendLink_Module')) {
                $friendlink_module = Simple_FriendLink_Module::get_instance();
                $friendlink_module->save_settings($settings);
                echo '<div class="notice notice-success is-dismissible"><p>' . __('è®¾ç½®ä¿å­˜æˆåŠŸï¼', 'wordpress-toolkit') . '</p></div>';
            }
        }

        // è·å–å½“å‰è®¾ç½®
        if (class_exists('Simple_FriendLink_Module')) {
            $friendlink_module = Simple_FriendLink_Module::get_instance();
            $settings = $friendlink_module->get_settings();
        } else {
            $settings = array(
                'allow_user_submit' => true,
                'require_login' => true,
                'admin_approval' => false,
                'max_links_per_page' => 30
            );
        }

        // æ˜¾ç¤ºè®¾ç½®è¡¨å•
        ?>
        <div class="wrap">
            <h1><?php echo __('ç®€æ´å‹æƒ…é“¾æ¥è®¾ç½®', 'wordpress-toolkit'); ?></h1>

            <form method="post" action="">
                <?php wp_nonce_field('wordpress_toolkit_simple_friendlink'); ?>

                <table class="form-table">
                    <tr>
                        <th scope="row"><?php _e('ç”¨æˆ·æäº¤', 'wordpress-toolkit'); ?></th>
                        <td>
                            <label>
                                <input type="checkbox" name="allow_user_submit" value="1" <?php checked($settings['allow_user_submit']); ?>>
                                <?php _e('å…è®¸ç”¨æˆ·æäº¤å‹æƒ…é“¾æ¥', 'wordpress-toolkit'); ?>
                            </label>
                        </td>
                    </tr>

                    <tr>
                        <th scope="row"><?php _e('éœ€è¦ç™»å½•', 'wordpress-toolkit'); ?></th>
                        <td>
                            <label>
                                <input type="checkbox" name="require_login" value="1" <?php checked($settings['require_login']); ?>>
                                <?php _e('ç”¨æˆ·å¿…é¡»ç™»å½•æ‰èƒ½æäº¤', 'wordpress-toolkit'); ?>
                            </label>
                        </td>
                    </tr>

                    <tr>
                        <th scope="row"><?php _e('ç®¡ç†å‘˜å®¡æ ¸', 'wordpress-toolkit'); ?></th>
                        <td>
                            <label>
                                <input type="checkbox" name="admin_approval" value="1" <?php checked($settings['admin_approval']); ?>>
                                <?php _e('ç”¨æˆ·æäº¤çš„é“¾æ¥éœ€è¦ç®¡ç†å‘˜å®¡æ ¸', 'wordpress-toolkit'); ?>
                            </label>
                        </td>
                    </tr>

                    <tr>
                        <th scope="row"><?php _e('æ¯é¡µæ˜¾ç¤ºæ•°é‡', 'wordpress-toolkit'); ?></th>
                        <td>
                            <input type="number" name="max_links_per_page" value="<?php echo $settings['max_links_per_page']; ?>" min="5" max="50" step="5">
                            <p class="description"><?php _e('å‹æƒ…é“¾æ¥é¡µé¢æ¯é¡µæ˜¾ç¤ºçš„é“¾æ¥æ•°é‡ï¼ˆé»˜è®¤ï¼š30ï¼‰', 'wordpress-toolkit'); ?></p>
                        </td>
                    </tr>

                                    </table>

                <p class="submit">
                    <input type="submit" name="save_settings" class="button button-primary" value="<?php _e('ä¿å­˜è®¾ç½®', 'wordpress-toolkit'); ?>">
                </p>
            </form>
        </div>
        <?php
    }

    /**
     * è‡ªåŠ¨æ‘˜è¦ç®¡ç†é¡µé¢ - å·¥å…·ç®±èœå•ä¸­
     */
    public function auto_excerpt_admin_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // éªŒè¯nonceï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰
        if (isset($_POST['action']) && !wp_verify_nonce($_POST['_wpnonce'], 'wordpress_toolkit_auto_excerpt')) {
            wp_die(__('å®‰å…¨éªŒè¯å¤±è´¥', 'wordpress-toolkit'));
        }

        // æ˜¾ç¤ºç®¡ç†é¡µé¢
        if ($this->auto_excerpt) {
            ?>
            <div class="wrap">
                <h1><?php _e('è‡ªåŠ¨æ‘˜è¦ç®¡ç†', 'wordpress-toolkit'); ?></h1>

                <?php
                error_log("WordPress Toolkit: Loading auto excerpt admin page");
                $stats = $this->auto_excerpt->get_excerpt_stats();
                error_log("WordPress Toolkit: Stats loaded - " . print_r($stats, true));
                ?>

                <div class="postbox" style="margin-top: 20px;">
                    <div class="inside">
                        <table class="form-table">
                            <tr>
                                <td width="20%">
                                    <strong><?php _e('æ–‡ç« æ€»æ•°', 'wordpress-toolkit'); ?></strong>
                                </td>
                                <td width="20%">
                                    <span class="dashicons dashicons-post" style="color: #0073aa;"></span>
                                    <?php echo number_format($stats['total_posts']); ?>
                                </td>
                                <td width="20%">
                                    <strong><?php _e('æœ‰æ‘˜è¦æ–‡ç« ', 'wordpress-toolkit'); ?></strong>
                                </td>
                                <td width="20%">
                                    <span class="dashicons dashicons-yes-alt" style="color: #00a32a;"></span>
                                    <?php echo number_format($stats['with_excerpt']); ?>
                                </td>
                                <td width="20%">
                                    <strong><?php _e('æ— æ‘˜è¦æ–‡ç« ', 'wordpress-toolkit'); ?></strong>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <strong><?php _e('æ— æ‘˜è¦æ–‡ç« æ•°é‡', 'wordpress-toolkit'); ?></strong>
                                </td>
                                <td>
                                    <span class="dashicons dashicons-no-alt" style="color: #d63638;"></span>
                                    <?php echo number_format($stats['without_excerpt']); ?>
                                </td>
                                <td>
                                    <strong><?php _e('æ‘˜è¦è¦†ç›–ç‡', 'wordpress-toolkit'); ?></strong>
                                </td>
                                <td colspan="2">
                                    <span class="dashicons dashicons-chart-bar" style="color: #0073aa;"></span>
                                    <?php echo $stats['coverage_rate']; ?>%
                                    <?php if ($stats['ai_generated'] > 0): ?>
                                        <br><span class="badge-ai" style="margin-top: 5px; display: inline-block;">ğŸ¤– <?php echo sprintf(__('AIç”Ÿæˆï¼š%dç¯‡', 'wordpress-toolkit'), $stats['ai_generated']); ?></span>
                                    <?php endif; ?>
                                </td>
                            </tr>
                        </table>

                        <?php if ($stats['ai_generated'] > 0): ?>
                        <p style="margin-top: 15px;">
                            <span class="badge-ai">ğŸ¤– <?php echo sprintf(__('AIç”Ÿæˆæ‘˜è¦ï¼š%dç¯‡', 'wordpress-toolkit'), $stats['ai_generated']); ?></span>
                        </p>
                        <?php endif; ?>
                    </div>
                </div>

                <div class="postbox" style="margin-top: 20px;">
                    <div class="inside">
                        <!-- ç­›é€‰å™¨ -->
                        <p>
                            <form method="get" action="" style="display: inline;">
                                <input type="hidden" name="page" value="wordpress-toolkit-auto-excerpt">
                                <select name="status" id="excerpt-status-filter">
                                    <option value="all" <?php selected(isset($_GET['status']) ? $_GET['status'] : 'all', 'all'); ?>><?php _e('å…¨éƒ¨æ–‡ç« ', 'wordpress-toolkit'); ?></option>
                                    <option value="with_excerpt" <?php selected(isset($_GET['status']) ? $_GET['status'] : 'all', 'with_excerpt'); ?>><?php _e('æœ‰æ‘˜è¦æ–‡ç« ', 'wordpress-toolkit'); ?></option>
                                    <option value="without_excerpt" <?php selected(isset($_GET['status']) ? $_GET['status'] : 'all', 'without_excerpt'); ?>><?php _e('æ— æ‘˜è¦æ–‡ç« ', 'wordpress-toolkit'); ?></option>
                                </select>
                                <button type="submit" class="button"><?php _e('ç­›é€‰', 'wordpress-toolkit'); ?></button>
                            </form>
                        </p>

                        <!-- æ‰¹é‡æ“ä½œ -->
                        <div class="tablenav top">
                            <div class="alignleft actions bulkactions">
                                <button type="button" id="batch-generate-excerpts" class="button button-primary">
                                    <span class="dashicons dashicons-magic"></span>
                                    <?php _e('ä¸ºæ— æ‘˜è¦æ–‡ç« ç”Ÿæˆæ‘˜è¦', 'wordpress-toolkit'); ?>
                                </button>
                                <span class="spinner" id="batch-generate-spinner" style="display: none;"></span>
                            </div>
                            <div class="alignright">
                                <span class="description" id="batch-generate-status">
                                    <?php _e('ç‚¹å‡»æŒ‰é’®ä¸ºæ‰€æœ‰æ— æ‘˜è¦çš„æ–‡ç« è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦', 'wordpress-toolkit'); ?>
                                </span>
                            </div>
                            <br class="clear">
                        </div>

                        <!-- æ‰¹é‡æ“ä½œç»“æœ -->
                        <div id="batch-generate-result" style="display: none; margin: 15px 0;"></div>

                        <!-- æ–‡ç« åˆ—è¡¨ -->
                        <?php
                        $current_page = isset($_GET['paged']) ? intval($_GET['paged']) : 1;
                        $status = isset($_GET['status']) ? sanitize_text_field($_GET['status']) : 'all';

                        error_log("WordPress Toolkit: Loading excerpt list - page: $current_page, status: $status");
                        $excerpt_list = $this->auto_excerpt->get_excerpt_list($current_page, 15, $status);
                        error_log("WordPress Toolkit: Excerpt list loaded - " . print_r($excerpt_list, true));

                        // æ·»åŠ è°ƒè¯•ä¿¡æ¯å’Œé”™è¯¯å¤„ç†
                        if (empty($excerpt_list) || !isset($excerpt_list['posts'])) {
                            echo '<div class="notice notice-warning"><p>æ‘˜è¦åˆ—è¡¨æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯æ—¥å¿—ã€‚</p></div>';
                            error_log("WordPress Toolkit: Excerpt list data is invalid");
                        } elseif (empty($excerpt_list['posts'])) {
                            echo '<div class="notice notice-info"><p>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ–‡ç« ã€‚</p></div>';
                            error_log("WordPress Toolkit: No posts found matching criteria");
                        } else {
                            error_log("WordPress Toolkit: Displaying " . count($excerpt_list['posts']) . " posts");
                        ?>
                        <table class="wp-list-table widefat fixed striped">
                            <thead>
                                <tr>
                                    <th><?php _e('æ ‡é¢˜', 'wordpress-toolkit'); ?></th>
                                    <th><?php _e('æ‘˜è¦çŠ¶æ€', 'wordpress-toolkit'); ?></th>
                                    <th><?php _e('æ‘˜è¦é•¿åº¦', 'wordpress-toolkit'); ?></th>
                                    <th><?php _e('å†…å®¹é•¿åº¦', 'wordpress-toolkit'); ?></th>
                                    <th><?php _e('å‘å¸ƒæ—¥æœŸ', 'wordpress-toolkit'); ?></th>
                                    <th><?php _e('æ“ä½œ', 'wordpress-toolkit'); ?></th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($excerpt_list['posts'] as $post): ?>
                                <tr>
                                    <td>
                                        <strong><a href="<?php echo esc_url($post['edit_url']); ?>" target="_blank"><?php echo esc_html($post['title']); ?></a></strong>
                                        <?php if ($post['status'] !== 'publish'): ?>
                                        <span class="status-draft">è‰ç¨¿</span>
                                        <?php endif; ?>
                                    </td>
                                    <td>
                                        <?php if ($post['has_excerpt']): ?>
                                            <span class="status-active"><?php _e('æœ‰æ‘˜è¦', 'wordpress-toolkit'); ?></span>
                                        <?php else: ?>
                                            <span class="status-inactive"><?php _e('æ— æ‘˜è¦', 'wordpress-toolkit'); ?></span>
                                        <?php endif; ?>
                                    </td>
                                    <td><?php echo $post['excerpt_length']; ?> <?php _e('å­—ç¬¦', 'wordpress-toolkit'); ?></td>
                                    <td><?php echo $post['content_length']; ?> <?php _e('å­—ç¬¦', 'wordpress-toolkit'); ?></td>
                                    <td><?php echo $post['date']; ?></td>
                                    <td>
                                        <a href="<?php echo esc_url($post['edit_url']); ?>" class="button button-small" target="_blank"><?php _e('ç¼–è¾‘', 'wordpress-toolkit'); ?></a>
                                        <a href="<?php echo esc_url($post['view_url']); ?>" class="button button-small" target="_blank"><?php _e('æŸ¥çœ‹', 'wordpress-toolkit'); ?></a>
                                        <?php if (!$post['has_excerpt']): ?>
                                        <button type="button" class="button button-small button-primary generate-excerpt-single" data-post-id="<?php echo $post['ID']; ?>">
                                            <span class="dashicons dashicons-magic"></span>ç”Ÿæˆæ‘˜è¦
                                        </button>
                                        <?php endif; ?>
                                    </td>
                                </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>

                        <!-- åˆ†é¡µ -->
                        <?php if ($excerpt_list['pages'] > 1): ?>
                        <div class="tablenav bottom">
                            <div class="tablenav-pages">
                                <?php
                                $current_url = admin_url('admin.php?page=wordpress-toolkit-auto-excerpt');
                                if (isset($_GET['status'])) {
                                    $current_url .= '&status=' . urlencode($_GET['status']);
                                }
                                ?>
                                <span class="displaying-num">
                                    <?php echo sprintf(__('æ˜¾ç¤º %d-%d å…± %d é¡¹', 'wordpress-toolkit'),
                                        (($current_page - 1) * 15) + 1,
                                        min($current_page * 15, $excerpt_list['total']),
                                        $excerpt_list['total']
                                    ); ?>
                                </span>
                                <?php
                                // ä½¿ç”¨WordPressæ ‡å‡†çš„paginate_linkså‡½æ•°
                                $pagination_args = array(
                                    'base' => $current_url . '&paged=%#%',
                                    'format' => '',
                                    'total' => $excerpt_list['pages'],
                                    'current' => $current_page,
                                    'show_all' => false,
                                    'prev_next' => true,
                                    'prev_text' => __('Â« ä¸Šä¸€é¡µ'),
                                    'next_text' => __('ä¸‹ä¸€é¡µ Â»'),
                                    'end_size' => 1,
                                    'mid_size' => 2,
                                    'type' => 'array',
                                    'add_args' => false,
                                    'add_fragment' => ''
                                );

                                $page_links = paginate_links($pagination_args);

                                if (!empty($page_links)):
                                    echo '<span class="pagination-links">';
                                    foreach ($page_links as $link):
                                        echo $link;
                                    endforeach;
                                    echo '</span>';
                                endif;
                                ?>
                            </div>
                        </div>
                        <?php endif; // End if ($excerpt_list['pages'] > 1) ?>
                            <?php } // End of else from posts check ?>
                    </div>
                </div>
            </div>

            <style>
            /* ç®€åŒ–çš„çŠ¶æ€æ ·å¼ */
            .status-active {
                color: #00a32a;
                font-weight: bold;
            }
            .status-inactive {
                color: #d63638;
                font-weight: bold;
            }
            .status-draft {
                display: inline-block;
                background: #f0f0f1;
                color: #50575e;
                padding: 2px 8px;
                border-radius: 3px;
                font-size: 11px;
                font-weight: 500;
                margin-left: 8px;
            }
            .badge-ai {
                display: inline-block;
                background: linear-gradient(135deg, #0073aa, #005a87);
                color: #fff;
                padding: 4px 12px;
                border-radius: 16px;
                font-size: 12px;
                font-weight: 500;
            }

            /* ä½¿ç”¨WordPressæ ‡å‡†åˆ†é¡µæ ·å¼ï¼Œä¿æŒä¸åå°å…¶ä»–åŠŸèƒ½ä¸€è‡´ */

            /* ç»Ÿä¸€æ‰€æœ‰æ“ä½œæŒ‰é’®å®½åº¦ */
            .tablenav td .button.button-small {
                min-width: 60px !important;
                max-width: 70px !important;
                white-space: nowrap !important;
                text-align: center !important;
                padding: 0 8px !important;
                font-size: 13px !important;
                height: 30px !important;
                line-height: 28px !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                display: inline-block !important;
                vertical-align: middle !important;
            }
            .generate-excerpt-single {
                min-width: 90px !important;
                max-width: 100px !important;
                white-space: nowrap !important;
                text-align: center !important;
                padding: 0 8px !important;
                font-size: 13px !important;
                height: 30px !important;
                line-height: 30px !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                display: inline-flex !important;
                vertical-align: middle !important;
                align-items: center !important;
                justify-content: center !important;
            }
            .generate-excerpt-single.button-primary {
                background: #0073aa !important;
                border-color: #0073aa !important;
                color: #fff !important;
            }
            .generate-excerpt-single.button-secondary {
                background: #f6f7f7 !important;
                border-color: #ddd !important;
                color: #50575e !important;
            }
            .generate-excerpt-single .dashicons {
                font-size: 14px !important;
                height: 14px !important;
                width: 14px !important;
                vertical-align: middle !important;
                margin-right: 0px !important;
                margin-left: 0px !important;
                display: inline-block !important;
            }
            .generate-excerpt-single .dashicons + * {
                margin-left: 2px !important;
            }
            </style>

            <script>
            jQuery(document).ready(function($) {
                // æ‰¹é‡ç”Ÿæˆæ‘˜è¦
                $('#batch-generate-excerpts').on('click', function(e) {
                    e.preventDefault();

                    var $button = $(this);
                    var $spinner = $('#batch-generate-spinner');
                    var $status = $('#batch-generate-status');
                    var $result = $('#batch-generate-result');

                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    $button.prop('disabled', true);
                    $spinner.show();
                    $status.text('æ­£åœ¨ä¸ºæ— æ‘˜è¦çš„æ–‡ç« ç”Ÿæˆæ‘˜è¦ï¼Œè¯·ç¨å€™...');
                    $result.hide();

                    // å‘é€AJAXè¯·æ±‚
                    $.ajax({
                        url: ajaxurl,
                        type: 'POST',
                        data: {
                            action: 'batch_generate_excerpts',
                            nonce: '<?php echo wp_create_nonce('batch_generate_excerpts_nonce'); ?>'
                        },
                        success: function(response) {
                            if (response.success) {
                                var data = response.data;
                                var message = '<div class="notice notice-success is-dismissible"><p>' +
                                    'æ‰¹é‡ç”Ÿæˆæ‘˜è¦å®Œæˆï¼<br>' +
                                    'æˆåŠŸï¼š' + data.success_count + ' ç¯‡<br>' +
                                    'å¤±è´¥ï¼š' + data.error_count + ' ç¯‡';

                                if (data.error_count > 0) {
                                    message += '<br>è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹æ—¥å¿—';
                                }

                                message += '</p></div>';
                                $result.html(message).show();
                                $status.text('æ‰¹é‡ç”Ÿæˆæ‘˜è¦å®Œæˆï¼');

                                // 3ç§’ååˆ·æ–°é¡µé¢ä»¥æ˜¾ç¤ºæ›´æ–°åçš„æ•°æ®
                                setTimeout(function() {
                                    window.location.reload();
                                }, 3000);
                            } else {
                                $result.html('<div class="notice notice-error"><p>æ‰¹é‡ç”Ÿæˆå¤±è´¥ï¼š' + response.data.message + '</p></div>').show();
                                $status.text('æ‰¹é‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
                            }
                        },
                        error: function() {
                            $result.html('<div class="notice notice-error"><p>ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•</p></div>').show();
                            $status.text('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
                        },
                        complete: function() {
                            $button.prop('disabled', false);
                            $spinner.hide();
                        }
                    });
                });

                // å•ä¸ªæ–‡ç« ç”Ÿæˆæ‘˜è¦
                $('.generate-excerpt-single').on('click', function(e) {
                    e.preventDefault();

                    var $button = $(this);
                    var postId = $button.data('post-id');
                    var originalText = $button.html();

                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    $button.prop('disabled', true).html('<span class="dashicons dashicons-spinner"></span> ç”Ÿæˆä¸­...');

                    // å‘é€AJAXè¯·æ±‚
                    $.ajax({
                        url: ajaxurl,
                        type: 'POST',
                        data: {
                            action: 'generate_single_excerpt',
                            post_id: postId,
                            nonce: '<?php echo wp_create_nonce('generate_single_excerpt_nonce'); ?>'
                        },
                        success: function(response) {
                            if (response.success) {
                                var data = response.data;
                                var message = '<div class="notice notice-success is-dismissible"><p>' +
                                    'æ‘˜è¦ç”ŸæˆæˆåŠŸï¼<br>' +
                                    'æ–‡ç« ï¼š' + data.post_title + '<br>' +
                                    'æ‘˜è¦é•¿åº¦ï¼š' + data.excerpt_length + ' å­—ç¬¦' +
                                    '</p></div>';

                                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                                $('#batch-generate-result').html(message).show();

                                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                                $button.removeClass('button-primary').addClass('button-secondary')
                                       .html('<span class="dashicons dashicons-yes"></span> å·²ç”Ÿæˆ')
                                       .prop('disabled', true);

                                // æ›´æ–°è¡¨æ ¼ä¸­çš„çŠ¶æ€æ˜¾ç¤º
                                var $row = $button.closest('tr');
                                $row.find('td:nth-child(2)').html('<span class="status-active">æœ‰æ‘˜è¦</span>');
                                $row.find('td:nth-child(3)').text(data.excerpt_length + ' å­—ç¬¦');

                            } else {
                                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                                $('#batch-generate-result').html('<div class="notice notice-error"><p>æ‘˜è¦ç”Ÿæˆå¤±è´¥ï¼š' + response.data.message + '</p></div>').show();
                                $button.html(originalText).prop('disabled', false);
                            }
                        },
                        error: function() {
                            $('#batch-generate-result').html('<div class="notice notice-error"><p>ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•</p></div>').show();
                            $button.html(originalText).prop('disabled', false);
                        }
                    });
                });
            });
            </script>
            <?php
        } else {
            echo '<div class="wrap"><div class="error"><p>' . __('è‡ªåŠ¨æ‘˜è¦æ¨¡å—æœªæ­£ç¡®åŠ è½½', 'wordpress-toolkit') . '</p></div></div>';
        }
    }

    /**
     * è‡ªåŠ¨æ‘˜è¦è®¾ç½®é¡µé¢ - è®¾ç½®èœå•ä¸­
     */
    public function auto_excerpt_settings_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // éªŒè¯nonceï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰
        if (isset($_POST['action']) && !wp_verify_nonce($_POST['_wpnonce'], 'wordpress_toolkit_auto_excerpt')) {
            wp_die(__('å®‰å…¨éªŒè¯å¤±è´¥', 'wordpress-toolkit'));
        }

        if ($this->auto_excerpt) {
            // è°ƒç”¨è‡ªåŠ¨æ‘˜è¦æ¨¡å—çš„è®¾ç½®é¡µé¢
            $this->auto_excerpt->settings_page();
        } else {
            echo '<div class="wrap"><h1>' . __('è‡ªåŠ¨æ‘˜è¦è®¾ç½®', 'wordpress-toolkit') . '</h1><div class="error"><p>' . __('Auto Excerpt æ¨¡å—æœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥æ’ä»¶è®¾ç½®ã€‚', 'wordpress-toolkit') . '</p></div></div>';
        }
    }

/**
     * ç½‘ç«™å¡ç‰‡é¡µé¢ - æ”¾åœ¨å·¥å…·ç®±èœå•ä¸­
     */
    public function custom_cards_list_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // éªŒè¯nonceï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰
        if (isset($_POST['action']) && !wp_verify_nonce($_POST['_wpnonce'], 'wordpress_toolkit_custom_card')) {
            wp_die(__('å®‰å…¨éªŒè¯å¤±è´¥', 'wordpress-toolkit'));
        }

        // è°ƒè¯•æ—¥å¿—
        if (defined('WP_DEBUG') && WP_DEBUG) {
            error_log('WordPress Toolkit: Custom Cards list page called');
        }

        if ($this->custom_card) {
            // è°ƒç”¨è‡ªå®šä¹‰å¡ç‰‡æ¨¡å—çš„å¡ç‰‡åˆ—è¡¨é¡µé¢
            $this->custom_card->cards_list_page();
        } else {
            echo '<div class="wrap"><div class="error"><p>Custom Card æ¨¡å—æœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥æ’ä»¶è®¾ç½®ã€‚</p></div></div>';
        }
    }
    
    /**
     * Age Calculatorç®¡ç†é¡µé¢ - å®‰å…¨ç‰ˆæœ¬
     */
    public function age_calculator_admin_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }
        
        // éªŒè¯nonceï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰
        if (isset($_POST['action']) && !wp_verify_nonce($_POST['_wpnonce'], 'wordpress_toolkit_age_calculator')) {
            wp_die(__('å®‰å…¨éªŒè¯å¤±è´¥', 'wordpress-toolkit'));
        }
        
        if ($this->age_calculator) {
            $this->age_calculator->admin_page();
        }
    }
    
    /**
     * Time Capsuleç®¡ç†é¡µé¢ - å®‰å…¨ç‰ˆæœ¬
     */
    public function time_capsule_admin_page() {
        // éªŒè¯ç”¨æˆ·æƒé™ - å…è®¸ç®¡ç†å‘˜å’Œè®¢é˜…è€…è®¿é—®
        if (!current_user_can('manage_options') && !current_user_can('read')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // éªŒè¯nonceï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰- åªåœ¨æœ‰POSTæ•°æ®æ—¶éªŒè¯
        if (!empty($_POST) && isset($_POST['action']) && !wp_verify_nonce($_POST['_wpnonce'], 'wordpress_toolkit_time_capsule')) {
            wp_die(__('å®‰å…¨éªŒè¯å¤±è´¥', 'wordpress-toolkit'));
        }

        if ($this->time_capsule) {
            $this->time_capsule->admin_page();
        }
    }

    /**
     * å‹æƒ…é“¾æ¥ç®¡ç†é¡µé¢ - ç»Ÿä¸€ç®¡ç†é¡µé¢
     */
    public function friendlinks_admin_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }

        // ç®€åŒ–éªŒè¯ - å°†nonceéªŒè¯ç§»åˆ°å…·ä½“çš„æ“ä½œå¤„ç†å‡½æ•°ä¸­
        // é¿å…åœ¨é¡µé¢åŠ è½½æ—¶è¿›è¡ŒéªŒè¯ï¼Œé˜²æ­¢è¯¯æŠ¥

        if ($this->simple_friendlink_admin) {
            // è°ƒç”¨å‹æƒ…é“¾æ¥ç®¡ç†é¡µé¢çš„ç»Ÿä¸€è§†å›¾
            $this->simple_friendlink_admin->unified_admin_page();
        } else {
            echo '<div class="wrap"><div class="error"><p>' . __('å‹æƒ…é“¾æ¥ç®¡ç†æ¨¡å—æœªæ­£ç¡®åŠ è½½', 'wordpress-toolkit') . '</p>';
            echo '<br><strong>è°ƒè¯•ä¿¡æ¯:</strong><br>';
            echo 'simple_friendlink_admin: ' . ($this->simple_friendlink_admin ? 'å·²åŠ è½½' : 'æœªåŠ è½½') . '<br>';
            echo 'simple_friendlink: ' . ($this->simple_friendlink ? 'å·²åŠ è½½' : 'æœªåŠ è½½') . '<br>';
            echo 'WordPresså·¥å…·åŒ…ç‰ˆæœ¬: ' . WORDPRESS_TOOLKIT_VERSION . '<br>';
            echo '</p></div></div>';
        }
    }

    /**
     * CookieGuardç®¡ç†é¡µé¢ - å®‰å…¨ç‰ˆæœ¬
     */
    public function cookieguard_admin_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }
        
        // éªŒè¯nonceï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰
        if (isset($_POST['action']) && !wp_verify_nonce($_POST['_wpnonce'], 'wordpress_toolkit_cookieguard')) {
            wp_die(__('å®‰å…¨éªŒè¯å¤±è´¥', 'wordpress-toolkit'));
        }
        
        if ($this->cookieguard) {
            $this->cookieguard->admin_page();
        }
    }
    
    
    /**
     * åŠŸèƒ½è¯´æ˜é¡µé¢ - ç»Ÿä¸€çš„åŠŸèƒ½è¯´æ˜
     */
    public function toolbox_about_page() {
        // éªŒè¯ç”¨æˆ·æƒé™
        if (!current_user_can('manage_options')) {
            wp_die(__('æƒé™ä¸è¶³', 'wordpress-toolkit'));
        }
        ?>
        <div class="wrap">
            <h1>WordPress Toolkit - åŠŸèƒ½è¯´æ˜</h1>
            <div class="wordpress-toolkit-about">

                <div class="quick-links">
                    <h3>å¿«é€Ÿå¯¼èˆª</h3>
                    <div class="quick-links-grid">
                        <a href="<?php echo esc_url(admin_url('admin.php?page=wordpress-toolkit-cards-list')); ?>" class="quick-link">
                            <span class="dashicons dashicons-admin-links"></span>
                            <span>ç½‘ç«™å¡ç‰‡</span>
                        </a>
                        <a href="<?php echo esc_url(admin_url('admin.php?page=wordpress-toolkit-time-capsule')); ?>" class="quick-link">
                            <span class="dashicons dashicons-archive"></span>
                            <span>ç‰©å“ç®¡ç†</span>
                        </a>
                        <a href="<?php echo esc_url(admin_url('admin.php?page=wordpress-toolkit-friendlinks')); ?>" class="quick-link">
                            <span class="dashicons dashicons-networking"></span>
                            <span>å‹æƒ…é“¾æ¥ç®¡ç†</span>
                        </a>
                        <a href="<?php echo esc_url(admin_url('options-general.php?page=wordpress-toolkit-custom-card-settings')); ?>" class="quick-link">
                            <span class="dashicons dashicons-admin-settings"></span>
                            <span>ç½‘ç«™å¡ç‰‡è®¾ç½®</span>
                        </a>
                        <a href="<?php echo esc_url(admin_url('options-general.php?page=wordpress-toolkit-age-calculator-settings')); ?>" class="quick-link">
                            <span class="dashicons dashicons-calendar"></span>
                            <span>å¹´é¾„è®¡ç®—å™¨è®¾ç½®</span>
                        </a>
                        <a href="<?php echo esc_url(admin_url('options-general.php?page=wordpress-toolkit-cookieguard-settings')); ?>" class="quick-link">
                            <span class="dashicons dashicons-shield"></span>
                            <span>CookieåŒæ„è®¾ç½®</span>
                        </a>
                    </div>
                </div>

                <div class="about-section">
                    <h2>ç½‘ç«™å¡ç‰‡æ¨¡å—</h2>
                    <div class="feature-card">
                        <h3>ä¸»è¦åŠŸèƒ½</h3>
                        <ul>
                            <li>è‡ªåŠ¨æŠ“å–ç½‘ç«™å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€æè¿°ã€å›¾ç‰‡ï¼‰</li>
                            <li>ç”Ÿæˆç¾è§‚çš„ç½‘ç«™å¡ç‰‡å±•ç¤º</li>
                            <li>æ”¯æŒæ‡’åŠ è½½å’Œå³æ—¶åŠ è½½ä¸¤ç§æ¨¡å¼</li>
                            <li>å¤šçº§ç¼“å­˜æ”¯æŒï¼ˆæ•°æ®åº“ã€Memcachedã€Opcacheï¼‰</li>
                            <li>GutenbergåŒºå—ç¼–è¾‘å™¨æ”¯æŒ</li>
                        </ul>
                        
                        <h3>ä½¿ç”¨æ–¹æ³•</h3>
                        <p>ä½¿ç”¨çŸ­ä»£ç  <code>[custom_card url="https://example.com"]</code> æˆ– <code>[custom_card_lazy url="https://example.com"]</code></p>
                        <p>åœ¨Gutenbergç¼–è¾‘å™¨ä¸­æœç´¢"Custom Card"åŒºå—</p>
                    </div>
                </div>
                
                <div class="about-section">
                    <h2>å¹´é¾„è®¡ç®—å™¨æ¨¡å—</h2>
                    <div class="feature-card">
                        <h3>ä¸»è¦åŠŸèƒ½</h3>
                        <ul>
                            <li>ç²¾ç¡®è®¡ç®—å‘¨å²å¹´é¾„ï¼Œè€ƒè™‘é—°å¹´2æœˆ29æ—¥</li>
                            <li>æ”¯æŒå¤šç§æ˜¾ç¤ºæ ¼å¼ï¼ˆå¹´ã€æœˆã€å¤©ã€è¯¦ç»†ï¼‰</li>
                            <li>è‡ªåŠ¨è®¡ç®—å’Œæ‰‹åŠ¨è®¡ç®—ä¸¤ç§æ¨¡å¼</li>
                            <li>æ”¯æŒè‡ªå®šä¹‰é¡µé¢æ¨¡æ¿</li>
                            <li>ç”¨æˆ·ç”Ÿæ—¥è®°å¿†åŠŸèƒ½ï¼ˆç™»å½•ç”¨æˆ·ï¼‰</li>
                        </ul>
                        
                        <h3>ä½¿ç”¨æ–¹æ³•</h3>
                        <p>ä½¿ç”¨çŸ­ä»£ç  <code>[manus_age_calculator]</code> æ˜¾ç¤ºè®¡ç®—å™¨è¡¨å•</p>
                        <p>ä½¿ç”¨çŸ­ä»£ç  <code>[manus_age_calculator_form]</code> ä»…æ˜¾ç¤ºè¡¨å•</p>
                        <p>ä½¿ç”¨é¡µé¢æ¨¡æ¿"å¹´é¾„è®¡ç®—å™¨é¡µé¢"åˆ›å»ºä¸“ç”¨é¡µé¢</p>
                    </div>
                </div>
                
                <div class="about-section">
                    <h2>ç‰©å“ç®¡ç†æ¨¡å—</h2>
                    <div class="feature-card">
                        <h3>ä¸»è¦åŠŸèƒ½</h3>
                        <ul>
                            <li>è®°å½•å’Œç®¡ç†ä¸ªäººç‰©å“è´­ä¹°ä¿¡æ¯</li>
                            <li>è¿½è¸ªç‰©å“ä½¿ç”¨æƒ…å†µå’Œä¿ä¿®çŠ¶æ€</li>
                            <li>åˆ†ç±»ç®¡ç†ç‰©å“ï¼ˆç”µå­äº§å“ã€å®¶å±…ç”¨å“ã€æœè£…ç­‰ï¼‰</li>
                            <li>ä¿ä¿®åˆ°æœŸæé†’åŠŸèƒ½</li>
                            <li>æ•°æ®ç»Ÿè®¡å’Œåˆ†æ</li>
                        </ul>
                        
                        <h3>ä½¿ç”¨æ–¹æ³•</h3>
                        <p>ä½¿ç”¨çŸ­ä»£ç  <code>[time_capsule]</code> æ˜¾ç¤ºç‰©å“åˆ—è¡¨å’Œæ·»åŠ è¡¨å•</p>
                        <p>ä½¿ç”¨çŸ­ä»£ç  <code>[time_capsule_item id="123"]</code> æ˜¾ç¤ºå•ä¸ªç‰©å“è¯¦æƒ…</p>
                        <p>ä½¿ç”¨é¡µé¢æ¨¡æ¿"ç‰©å“ç®¡ç†é¡µé¢"åˆ›å»ºä¸“ç”¨é¡µé¢</p>
                    </div>
                </div>
                
                <div class="about-section">
                    <h2>CookieåŒæ„æ¨¡å—</h2>
                    <div class="feature-card">
                        <h3>ä¸»è¦åŠŸèƒ½</h3>
                        <ul>
                            <li>ç¬¦åˆGDPRè¦æ±‚çš„CookieåŒæ„é€šçŸ¥</li>
                            <li>è‹¹æœé£æ ¼è®¾è®¡ï¼Œç¾è§‚æ˜“ç”¨</li>
                            <li>å¤šè¯­è¨€æ”¯æŒ</li>
                            <li>è‡ªå®šä¹‰æ ·å¼å’Œæ–‡æ¡ˆ</li>
                            <li>ç”¨æˆ·åå¥½è®°å¿†</li>
                        </ul>
                        
                        <h3>ä½¿ç”¨æ–¹æ³•</h3>
                        <p>æ¨¡å—è‡ªåŠ¨å¯ç”¨ï¼Œæ— éœ€çŸ­ä»£ç </p>
                        <p>åœ¨åå°è®¾ç½®ä¸­é…ç½®Cookieé€šçŸ¥æ ·å¼å’Œå†…å®¹</p>
                        <p>æ”¯æŒè‡ªå®šä¹‰CSSæ ·å¼è¦†ç›–</p>
                    </div>
                </div>

                <div class="about-section">
                    <h2>å‹æƒ…é“¾æ¥æ¨¡å—</h2>
                    <div class="feature-card">
                        <h3>ä¸»è¦åŠŸèƒ½</h3>
                        <ul>
                            <li>å®Œæ•´çš„å‹æƒ…é“¾æ¥ç®¡ç†ç³»ç»Ÿ</li>
                            <li>æ”¯æŒé“¾æ¥åˆ†ç±»å’ŒçŠ¶æ€ç®¡ç†</li>
                            <li>ç”¨æˆ·æäº¤å‹æƒ…é“¾æ¥åŠŸèƒ½</li>
                            <li>ç®¡ç†å‘˜å®¡æ ¸æœºåˆ¶ï¼ˆç»Ÿä¸€ç®¡ç†ç•Œé¢ï¼‰</li>
                            <li>å“åº”å¼ç½‘æ ¼å¸ƒå±€å±•ç¤º</li>
                            <li>æ”¯æŒç½‘ç«™Logoå’Œæè¿°</li>
                            <li>æœç´¢å’Œåˆ†é¡µåŠŸèƒ½</li>
                            <li>ä¸“ç”¨é¡µé¢æ¨¡æ¿</li>
                            <li>AJAXè¡¨å•æäº¤</li>
                        </ul>

                        <h3>åå°ç®¡ç†</h3>
                        <p>ç®¡ç†å‘˜å¯åœ¨"å·¥å…·ç®±" â†’ "å‹æƒ…é“¾æ¥ç®¡ç†"ä¸­ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å‹æƒ…é“¾æ¥</p>
                        <p>ç®¡ç†é¡µé¢åŒ…å«"å·²å‘å¸ƒé“¾æ¥"å’Œ"å¾…å®¡æ ¸ç”³è¯·"ä¸¤ä¸ªæ ‡ç­¾é¡µ</p>
                        <p>æ”¯æŒæ‰¹é‡æ“ä½œã€å•ä¸ªå®¡æ ¸ã€åˆ é™¤ç­‰åŠŸèƒ½</p>

                        <h3>å‰ç«¯æ˜¾ç¤º</h3>
                        <p>ä½¿ç”¨é¡µé¢æ¨¡æ¿"å‹æƒ…é“¾æ¥é¡µé¢"æˆ–"ç®€æ´å‹æƒ…é“¾æ¥é¡µé¢"åˆ›å»ºä¸“ç”¨é¡µé¢</p>
                        <p>é¡µé¢å°†è‡ªåŠ¨åŒ…å«å®Œæ•´çš„å‹æƒ…é“¾æ¥å±•ç¤ºå’Œæäº¤åŠŸèƒ½</p>
                    </div>
                </div>

                <div class="about-section">
                    <h2>è‡ªåŠ¨æ‘˜è¦æ¨¡å—</h2>
                    <div class="feature-card">
                        <h3>ä¸»è¦åŠŸèƒ½</h3>
                        <ul>
                            <li>ğŸ¤– <strong>DeepSeek AIæ™ºèƒ½æ‘˜è¦ç”Ÿæˆ</strong> - åŸºäºAIç†è§£æ–‡ç« æ ¸å¿ƒå†…å®¹</li>
                            <li>ğŸ”„ <strong>æ™ºèƒ½é™çº§æœºåˆ¶</strong> - AIå¤±è´¥æ—¶è‡ªåŠ¨ä½¿ç”¨æœ¬åœ°ç®—æ³•</li>
                            <li>ğŸ“ <strong>ä¸­è‹±æ–‡æ··åˆå¤„ç†</strong> - å®Œç¾æ”¯æŒå¤šè¯­è¨€å†…å®¹</li>
                            <li>âš™ï¸ <strong>çµæ´»å‚æ•°é…ç½®</strong> - å¯è°ƒèŠ‚åˆ›é€ æ€§ã€é•¿åº¦ç­‰å‚æ•°</li>
                            <li>ğŸ¯ <strong>ç²¾å‡†æ‘˜è¦æ§åˆ¶</strong> - ä¿æŒè¯­ä¹‰å®Œæ•´ï¼Œçªå‡ºé‡ç‚¹</li>
                            <li>âš™ï¸ <strong>åå°è®¾ç½®ç®¡ç†</strong> - ç»Ÿä¸€çš„é…ç½®å’Œæµ‹è¯•ç•Œé¢</li>
                            <li>ğŸ”§ <strong>APIè¿æ¥æµ‹è¯•</strong> - ç¡®ä¿AIæœåŠ¡æ­£å¸¸å·¥ä½œ</li>
                            <li>ğŸ“ <strong>ç¨‹åºåŒ–è°ƒç”¨</strong> - å¯ä¾›å…¶ä»–åŠŸèƒ½ä»£ç è°ƒç”¨</li>
                            <li>ğŸ›¡ï¸ <strong>ç¼–è¾‘é¡µé¢å…¼å®¹</strong> - é¿å…ç©ºç™½é¡µé¢é—®é¢˜</li>
                        </ul>

                        <h3>AIç”Ÿæˆä¼˜åŠ¿</h3>
                        <p>ä½¿ç”¨DeepSeek AIæŠ€æœ¯ï¼Œèƒ½å¤Ÿæ·±åº¦ç†è§£æ–‡ç« å†…å®¹ï¼Œç”Ÿæˆæ›´å‡†ç¡®ã€æ›´ç¬¦åˆè¯­ä¹‰çš„æ‘˜è¦ã€‚ç›¸æ¯”ä¼ ç»Ÿç®—æ³•ï¼ŒAIç”Ÿæˆçš„æ‘˜è¦å…·æœ‰æ›´å¥½çš„è¿è´¯æ€§å’Œæ¦‚æ‹¬æ€§ã€‚</p>

                        <h3>ä½¿ç”¨æ–¹æ³•</h3>
                        <p><strong>åŠŸèƒ½ç®¡ç†ï¼š</strong>åœ¨"å·¥å…·ç®±" â†’ "è‡ªåŠ¨æ‘˜è¦"ä¸­æŸ¥çœ‹åŠŸèƒ½çŠ¶æ€å’Œæ¦‚è§ˆ</p>
                        <p><strong>AIé…ç½®ï¼š</strong>åœ¨"è®¾ç½®" â†’ "è‡ªåŠ¨æ‘˜è¦"ä¸­é…ç½®DeepSeek APIå¯†é’¥å’Œç›¸å…³å‚æ•°</p>
                        <p><strong>APIæµ‹è¯•ï¼š</strong>åœ¨è®¾ç½®é¡µé¢æµ‹è¯•APIè¿æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
                        <p><strong>ç¨‹åºè°ƒç”¨ï¼š</strong>æ‘˜è¦ç”ŸæˆåŠŸèƒ½å¯ä¾›å…¶ä»–æ’ä»¶æˆ–ä¸»é¢˜ä»£ç è°ƒç”¨</p>

                        <h3>åå°ç®¡ç†</h3>
                        <p><strong>å·¥å…·ç®± â†’ è‡ªåŠ¨æ‘˜è¦ï¼š</strong>æŸ¥çœ‹åŠŸèƒ½æ¦‚è§ˆå’Œå½“å‰çŠ¶æ€</p>
                        <p><strong>è®¾ç½® â†’ è‡ªåŠ¨æ‘˜è¦ï¼š</strong>å®Œæ•´é…ç½®å’Œå‚æ•°è°ƒæ•´</p>
                        <p>æ”¯æŒDeepSeek AIé…ç½®ã€è¿æ¥æµ‹è¯•å’Œå‚æ•°è°ƒæ•´</p>

                        <h3>æ³¨æ„äº‹é¡¹</h3>
                        <p>â€¢ éœ€è¦é…ç½®DeepSeek APIå¯†é’¥æ‰èƒ½ä½¿ç”¨AIç”ŸæˆåŠŸèƒ½</p>
                        <p>â€¢ APIè°ƒç”¨ä¼šäº§ç”Ÿè´¹ç”¨ï¼Œè¯·å‚è€ƒDeepSeekçš„å®šä»·è¯´æ˜</p>
                        <p>â€¢ å¯ç”¨é™çº§æœºåˆ¶å¯ç¡®ä¿æœåŠ¡é«˜å¯ç”¨æ€§</p>
                    </div>
                </div>

                <div class="about-section">
                    <h2>é€šç”¨åŠŸèƒ½</h2>
                    <div class="feature-card">
                        <h3>æ‰€æœ‰æ¨¡å—å…±äº«çš„åŠŸèƒ½</h3>
                        <ul>
                            <li>å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯</li>
                            <li>å¤šè¯­è¨€æ”¯æŒï¼ˆå›½é™…åŒ–ï¼‰</li>
                            <li>æƒé™æ§åˆ¶ï¼Œç¡®ä¿å®‰å…¨æ€§</li>
                            <li>è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•</li>
                            <li>å®šæœŸæ›´æ–°å’Œç»´æŠ¤</li>
                        </ul>
                    </div>
                </div>
                
            </div>
        </div>
        
        <style>
        .wordpress-toolkit-about {
            max-width: 100%;
            box-sizing: border-box;
            width: 100%;
        }
        
        .about-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 100%;
            box-sizing: border-box;
        }
        
        .about-section h2 {
            color: #2271b1;
            border-bottom: 2px solid #2271b1;
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .feature-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 6px;
            border-left: 4px solid #2271b1;
            width: 100%;
            box-sizing: border-box;
        }
        
        .feature-card h3 {
            color: #2c3338;
            margin-top: 0;
        }
        
        .feature-card ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .feature-card li {
            margin-bottom: 5px;
            line-height: 1.5;
        }
        
        .feature-card code {
            background: #f0f0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media screen and (max-width: 782px) {
            .about-section {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .feature-card {
                padding: 15px;
            }
            
            .feature-card h3 {
                font-size: 16px;
            }
        }
        </style>
        <?php
    }
    
    /**
     * æ·»åŠ æ’ä»¶æ“ä½œé“¾æ¥
     */
    public function add_plugin_links($links) {
        $settings_link = '<a href="' . admin_url('admin.php?page=wordpress-toolkit') . '">è®¾ç½®</a>';
        $about_link = '<a href="' . admin_url('admin.php?page=wordpress-toolkit-about') . '">åŠŸèƒ½è¯´æ˜</a>';
        array_unshift($links, $about_link, $settings_link);
        return $links;
    }
}

// åˆå§‹åŒ–æ’ä»¶
WordPress_Toolkit::get_instance();
